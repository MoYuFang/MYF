[P5787 二分图 /【模板】线段树分治](https://www.luogu.com.cn/problem/P5787)

可撤销并查集可以用来维护动态图是否为二分图。

首先开一个变量动态维护在加边与删边过程中，那些只要存在一个就会使动态图成为不了二分图的边的个数，称作奇环贡献边数。

当往图中加入新的边 $(u,v)$ 时：
1. 若 $u$ 与 $v$ 的并查树不是同一颗，就直接 $unite$ 连边。
2. 若是同一颗，则分别求出 $u$ 与 $v$ 到根的边数的奇偶性，在利用这两个奇偶性判断 $u$ 与 $v$ 的树上路径的边数的奇偶性，以此来判断加边后是否构成奇环，若是则给奇环贡献边数加一，否则忽略这一条新加的边。

当往图中删边 $(u,v)$ 时：
1. 若 $u$ 与 $v$ 的并查树是同一颗，则直接让并查集撤销一次
2. 若是同一颗，还是先求出两点间路径边数的奇偶性，若该边是对奇环贡献边数有贡献那就让奇环贡献边数减一，若不是则这条边在之前加边时是被忽略的，现在仍忽略就行了。

值得思考的是，那些在上面加边删边操作中被忽略的边真的能直接忽略吗？先称它们为偶环贡献边，万一某条偶环贡献边不是先于并查树上的树边删除的，那直接忽略岂不导致算法出错？

但本题还将使用一个工具就是线段树分治，以时间段为线段树的值域，线段上每个节点用一个 $\text{vector}$ 保存哪些边在该节点所对应的时间区间中一直出现。

对于每条边，在线段树上做一次区间标记，在线段树上相应的节点上的 $\text{vector}$ 加上这条边。

然后 $\text{dfs}$ 整颗线段树，每下降到一个节点就将该节点的  $\text{vector}$ 中的全部边加入动态图。每下降到叶子节点（到达的时间段长度只有一），这时通过奇环贡献边数是否为零回答该时间段内动态图是否为二分图。离开节点时撤销 $\text{vector}$ 中的所有边。

可以发现所有偶数贡献边都会在对应的并查树的树边被撤销之前撤销，所以上面维护并查集的算法不会出错。

