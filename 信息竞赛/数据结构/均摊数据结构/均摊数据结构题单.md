[P6783 [Ynoi2008] rrusq](https://www.luogu.com.cn/problem/P6783) 对所有询问按照右端点升序排序，然后从左到右枚举矩阵，每次加入一个矩阵，维护每个关键点上最晚加入的矩阵的序号 $t_i$。加入到第 $r$ 个矩阵时，对区间 $[l, r]$ 的询问相当于所有满足 $t_i\ge l$ 的点的权值。于是需要用 $\text{KD-Tree}$ 来支持区间覆盖操作，用 $O(1)-O(\sqrt{m})$ 的分块维护 $f(x)$ 数组，$f(x)$ 表示 $t_i$ 为 $x$ 的关键点的贡献。每次打标记时判断子树中是否打了标记，如果有则需要将子树里的所有旧标记清除。注意到至多有 $O(m\sqrt{n})$ 个标记，每个标记只会出现、被删除各一次，每次回答查询则需要 $O(\sqrt{m})$，总时间复杂度为 $O(n\log n + m\sqrt{n} + q\sqrt{m})$。