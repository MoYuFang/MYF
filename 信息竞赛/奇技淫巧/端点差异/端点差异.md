本文起笔于```2021.11.24```。

先来考虑这三道题：

[P7707 「Wdsr-2.7」百花齐放的太阳花田](https://www.luogu.com.cn/problem/P7707) 

[oiclass P3900 o](..\..\题面\oiclass P3900 o.png) 

[P5599【XR-4】文本编辑器](https://www.luogu.com.cn/problem/P5599) 

第一道题中，每个查询中区间 $[l,r]$ 的答案可以通过 $[1,r]$ 和 $[1,l-1]$ 的答案之差加上修正因子得到，前者可以通过主席树以单次 $O(\log R)$ 求出，后者可以通过二分 + $\text{st}$ 表以单次 $O(\log n)$ 求出，所以单次查询的复杂度都是对数级别的，总复杂度就是线性对数级别的。

第二道题中，回答每个查询可转化对某个前缀 $[1,p]$ 查询答案，设在这一查询的时刻时，位置 $p$ 上的数为 $a(i)$，则对 $[1,p]$ 有贡献的 $a\in \{a(j)|1\leq j\leq i\}$，而且若 $j<i$，则 $a(j)$ 对 $[1,p]$ 的贡献就是 $a(j)$ 在这一时刻在整个区间中覆盖的面积，仅仅只是 $a(i)$ 对 $[1,p]$ 的贡献不一定 $a(i)$ 在这一时刻在整个区间中的覆盖面积，前 $i-1$ 个 $a(j)$ 贡献都是整体的，于是它们的贡献之和可以通过用树状数组维护一次多项式以单次 $O(\log n)$ 快速回答，后者可以用 $\text{st}$ 表以单次 $O(1)$，于是总复杂度就是 $O(q\log n)$。

第三题详见[题解](..\..\字符串\AC自动机\P5599 【XR-4】文本编辑器\P5599 【XR-4】文本编辑器.md)，对于查询的回答分为 $[l,l+d-1]$ 和 $[l+d,r]$ 两部分，前半部分暴力求解，后半部分用线段树求解。

归纳总结，有些数据结构题，询问的答案可以由一个主体与一个修正因子共同组成，两部分可以分别用不同的算法和数据结构求，修正因子往往跟端点处的性质相关，故这种特性称作端点差异。

