[P8504 No will to break](https://www.luogu.com.cn/problem/P8504) 首先考虑每个时刻安全概率为 $1$ 或 $0$ 的情况，此时容易想到一个正确贪心做法：从左到右，从第 $a$ 位枚举到第 $n$ 位，若现在是第 $i$ 位，若发现 $[i-a+1,i]$ 中聚会的时刻不满 $b$，则选择一个最靠右且还没有聚会的安全时刻，将这个安全时刻变成聚会时刻，如果聚会时刻还不满 $b$，则继续选择一个次右的空闲安全时刻，反复选取直到 $[i-a+1,i]$ 中的聚会时刻达到 $b$。于是在确定了每个时刻是安全还是危险后，每个安全时刻是否聚会就已经确定了，于是这道题的做法就清晰了，通过 $\text{dp}$ 计算出每个时刻是安全时刻且是聚会时刻的概率是多少。设 $f(i, s, t)$ 表示 $\text{dp}$ 到第 $i$ 个时刻，$[i-a+1,i]$ 中安全时刻的位置集合为 $s$，$[i-a+1,i]$ 中是聚会时刻的位置集合为 $t$ 时的概率大小，$g(i,s,t)$ 表示在与 $f(i,s,t)$ 状态相同情况下区间 $[1,i]$ 中聚会时刻的期望数。再设有辅助数值 $p_i$ 表示第 $i$ 时刻安全的概率，$q_i$ 表示第 $i$ 时刻不安全的概率。对第 $i+1$ 位是否是安全时刻分类讨论就可以得到转移方程，转移方程具体描述出来较复杂，但思想不难，故略去。代码实现时 $s,t$ 都是是 $a$ 位二进制数，且 $b\le|s|\le a,|t|=b$，且集合 $s$ 包含 $t$，于是 $s,t$ 的总组合个数为
$$
\sum_{k=b}^{a}{a\choose k}{k\choose b}={a\choose b}2^{a-b}
$$
本题中在 $a=9,b=3$ 时取最大 $5376$，可以压缩一下状态，总时间复杂度为 $O\left(\displaystyle {a\choose b}2^{a-b}n\right)$。