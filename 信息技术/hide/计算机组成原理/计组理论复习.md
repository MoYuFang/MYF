## MIPS 架构下单周期流水线 CPU 设计

MIPS 是为流水线设计的架构，所以其将每条的指令执行分为了 5 个步骤：取指 IF、读寄存器 ID、执行 EX、存储器访问 MEM、写回寄存器 WB。

尽管冯诺依曼体系下，指令和数据一视同仁，妥协于流水线的设计，在硬件结构中，指令存储器和数据存储器物理上是两个存储器，前者只读，后者可写可读。

EX 阶段中的 ALU 模块包括两部分：用于寄存输入端的输入寄存器、庞大的组合逻辑部分。

流水线设计下，有 4 个历史指令寄存器记录之前 4 条指令，Control Logic 根据映射出协同不同模块进行流水线工作的控制信号。

### 流水线冒险

#### 结构冒险。

硬件结构不支持同时进行读操作、写操作时，流水线可能发生结构冒险。

MIPS 架构下，读写操作的对象只有 寄存器堆（Register File）和 内存（Memory），避免结构冒险的解决方案是，用支持同时读写的 Register File 和 Memory。

#### 数据冒险

在流水线中，之前的指令还未完成 WB 操作，新指令就需要读取同寄存器或同内存地址下的数据，导致新指令取到的是旧数据。

根据指令类型有不同的解决方法。

# 习题

# 四、

# 五、

**5.1** 给定存储芯片，需组合出符号要求的存储器，要求说明地址译码方案、画出电路图。

只要解释清楚就行。

分四个部分：芯片选用方案、地址译码方案、芯片组件和电路图注释（`A<r:l>`用于代表信号）、电路图。

片选信号：有几组芯片就有几个片选信号，比如高 $n$ 位地址译码后产生 $2^n$ 个片选信号。


**5.2** 算效率提升比。

某处理器的CPI为1（如果所有访问能在L1 Cache命中），时钟频率为5GHz。假设访问一次主存的时间为100ns(包括所有的缺失处理)，设平均每条指令在L1 Cache 中的缺失率为2%；如果增加一个L2 Cache，访问时间为5ns，而且容量大到使L2 Cache缺失率减为0.5%，问处理器速率提高了多少？

答案 $11/4=2.75$ 倍。

草稿纸上写完物理公式后，首先检查公式是否正确，确认无误后再带入具体数据计算。


**5.3** 快表 TLB、页表 TB、Cache 的综合运用。

16 进制和 2 进制的互转需小心地检查。

分 TLB、TB、Cache 三个阶段独立处理。

每个阶段，写完 二进制地址 后，用下花括号标出是什么域。
