### DRAM

[【Branch】计算机是如何工作的？探索主内存，以 Micron DDR5为例](https://www.bilibili.com/video/BV1vP411c7pt/) 

DDR（Double Data Rate）在时钟的上下边沿进行数据传输，所以宣传上以时钟频率的两倍作为其带宽，如 6400MT/s 的 DDR5 的时钟频率为 3200 MHz。

DIMM（Dual Inline Memory Module 双列直插模块）指一种内存芯片的物理封装形式，是常见的 DDR 内存的封装形式，不同代的 DDR 内存通常有不同的 DIMM，比如 DDR4 主板 与 DDR5 主板互不兼容。

以有四个内存条（DIMM形式）插槽（支持4×16GB）的 Z790 主板（MotherBoard）为例，Intel CPU 可支持的 和 主板 上实际有的内存通道数均为 2，其中1、2槽和3、4槽分别共享一条内存通道，两条内存通道分属主板上的两层，每层在南北方向各负责 32bit 数据。

一个 16GB 的 Micro DDR5 芯片中的存储架构如下

| DDR Die(2G) | Bank Group | Bank | RAS(Row Address) | CAS(Column Address) |
| ----------- | ---------- | ---- | ---------------- | ------------------- |
| $8$         | $8$        | $4$  | $2^{16}$         | $2^{10}$            |

多 bank（32 banks）带来较大带宽。

[【硬核科普】为什么装机内存条推荐安装到第24槽而不是13槽？为什么ITX主板超频内存更容易？](https://www.bilibili.com/video/BV19A411a7sC)

省流：消费级 2DPC 4 slots 的主板，内存条插入顺序 2->4->1->3。
### Cache

全相联、组相联、直接映射

缺失替换策略
- 随机替换，常用于全相联，硬件实现方便
- LRU近似算法，如用 $1$ 个引用位应对 $2$ 路组相联，$3$ 个引用位应对 $4$ 路组相联，$2^{k}-1$ 个引用位应对 $2^k$ 路组相联。

写操作策略
- 写直达，需要写缓冲，写缓冲的深度可待定，当写缓冲满时，处理器必须等到写缓冲有空时再进行写操作，因此，处理器产生写操作的平均速度应低于写直达的速度。
- 写回，需要增多一个脏位，缺失时需要把脏数据写回到低级存储器中。
- 写分配，执行写操作时，若未命中，则先将数据载入到 Cache 中在执行写操作
- 写不分配，执行写操作时，若未命中，则不载入数据，只在主存中执行写操作

三级 Cache 一般集成在 CPU 的内核的 `RAM` 里。

### TB、TLB

疑问？
- 一个 64 位的地址是如何映射到物理地址的？
- cache 可支持的最大物理地址由**标记域**的大小决定吗？如果是，那扩展这个大小是不是就得换硬件（CPU、主板）
- 虚拟地址的范围大小由什么决定？最低级存储器的大小吗？为什么我的程序中 64 位的地址远大于我的电脑的最大内存。为什么虚拟地址要设计得怎么大？
- 页表 TB 这么大，为什么不多个进程共用一个 TB 呢？只要限制每个进程可访问哪些页、共享哪些页即可。
- 页表
- 主存应该分系统区和用户区吧，那用户区是 一页一页 存储数据吗？

### External

C++ 看 windows 页大小
```cpp
#include <Windows.h>
int main(){
    SYSTEM_INFO sysInfo;
    GetSystemInfo(&sysInfo);
    DWORD pageSize = sysInfo.dwPageSize;
    std::cout << "Page size: " << pageSize << " bytes" << std::endl;
    return 0;
}
```
